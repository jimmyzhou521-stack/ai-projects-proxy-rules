# 📝 使用说明

## 🚀 快速开始

这个项目提供两种方式来管理AI代理规则：

### 方法1：自动从GitHub爬取（推荐）

自动从多个热门GitHub仓库爬取最新的AI代理规则，并整合成统一的规则集。

**步骤：**

1. **安装依赖**

```bash
pip install -r requirements.txt
```

2. **运行爬取脚本**

```bash
python scripts/fetch_rules.py
```

这会从以下GitHub仓库获取规则：

- ACL4SSR
- blackmatrix7/ios_rule_script  
- Loyalsoldier/clash-rules
- GeQ1an/Rules

3. **生成规则文件**

```bash
python scripts/generate_rules.py
```

### 方法2：手动管理规则

如果您想添加自定义规则，可以编辑 `data/custom_rules.txt` 文件。

**编辑自定义规则：**

打开 `data/custom_rules.txt`，添加您的规则：

```
# 支持多种格式
DOMAIN-SUFFIX,example.com
DOMAIN,api.example.com
DOMAIN-KEYWORD,ai
IP-C IDR,1.2.3.4/24
IP-ASN,12345
```

然后运行：

```bash
python scripts/fetch_rules.py  # 爬取GitHub规则并合并您的自定义规则
python scripts/generate_rules.py  # 生成最终规则文件
```

## 🤖 GitHub Actions 自动化

本项目已配置GitHub Actions，会自动：

- 每天凌晨4点（北京时间）自动爬取最新规则
- 合并自定义规则
- 生成所有格式的规则文件
- 提交并推送到仓库

您也可以手动触发：

1. 访问：<https://github.com/你的用户名/ai-projects-proxy-rules/actions>
2. 选择 "Update AI Proxy Rules"
3. 点击 "Run workflow"

## 📊 支持的规则类型

- **DOMAIN**: 精确域名匹配
- **DOMAIN-SUFFIX**: 域名后缀匹配
- **DOMAIN-KEYWORD**: 域名关键词匹配  
- **IP-CIDR**: IP地址段匹配
- **IP-ASN**: 自治系统号匹配

## 🔧 支持的代理工具

生成的规则文件支持以下代理工具：

1. **Clash** - `rules/clash.yaml`
2. **Surge** - `rules/surge.conf`
3. **Quantumult X** - `rules/quantumult-x.conf`
4. **Shadowrocket** - `rules/shadowrocket.conf`
5. **Sing-box** - `rules/sing-box.json`
6. **Loon** - `rules/loon.conf`

## 📥 订阅地址

将仓库推送到GitHub后，您的订阅地址将是：

```
https://raw.githubusercontent.com/你的用户名/ai-projects-proxy-rules/main/rules/clash.yaml
https://raw.githubusercontent.com/你的用户名/ai-projects-proxy-rules/main/rules/surge.conf
https://raw.githubusercontent.com/你的用户名/ai-projects-proxy-rules/main/rules/sing-box.json
# ... 以此类推
```

## 🛠️ 高级配置

### 添加更多规则源

编辑 `scripts/fetch_rules.py`，在 `RULE_SOURCES` 列表中添加新的GitHub仓库：

```python
RULE_SOURCES = [
    {
        "name": "你的规则源名称",
        "urls": [
            "https://raw.githubusercontent.com/用户名/仓库名/分支/规则文件路径",
        ],
        "type": "clash"  # 或 "quantumult"
    },
    # ... 其他规则源
]
```

### 定制规则生成

您可以修改 `scripts/generate_rules.py` 来定制规则生成逻辑，比如：

- 修改规则注释  
- 调整规则排序
- 添加特殊规则处理

## 📚 目录结构

```
ai-projects-proxy-rules/
├── .github/
│   └── workflows/
│       └── update-rules.yml    # GitHub Actions 配置
├── data/
│   ├── ai_projects.json        # 整合后的规则数据
│   └── custom_rules.txt        # 自定义规则（您可编辑）
├── rules/  
│   ├── clash.yaml              # 生成的规则文件
│   ├── surge.conf
│   ├── quantumult-x.conf
│   ├── shadowrocket.conf
│   ├── sing-box.json
│   └── loon.conf
├── scripts/
│   ├── fetch_rules.py          # 爬取规则脚本
│   └── generate_rules.py       # 生成规则脚本
├── requirements.txt            # Python依赖
└── README.md                   # 项目说明
```

## ❓ 常见问题

**Q: 如何更新规则？**
A: GitHub Actions会自动每天更新。您也可以本地运行爬取脚本，或在GitHub上手动触发workflow。

**Q: 可以只使用某几个AI服务的规则吗？**
A: 可以。编辑 `data/custom_rules.txt`，只保留您需要的规则，然后运行生成脚本。

**Q: 规则文件太大怎么办？**
A: 可以修改 `scripts/fetch_rules.py`，只保留您需要的规则源。

**Q: 爬取速度慢或失败？**
A: 可能是网络问题。脚本会自动跳过失败的源，使用成功获取的规则。

## 📝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可

MIT License
